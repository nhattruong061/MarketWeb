<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head"></head>
<body>
    <nav th:replace="layout :: header"></nav>
	<!-- .container -->
	<!-- products -->
	<div class="products">	 
		<div class="container">
			<div class="col-md-9 product-w3ls-right">
				<!-- breadcrumbs --> 
				<ol class="breadcrumb breadcrumb1">
					<li><a href="index.html">Home</a></li>
					<li class="active">Products</li>
				</ol> 
				<div class="clearfix"> </div>
				<!-- //breadcrumbs -->
				<div class="product-top">
					<h4>Electronics</h4>
					<ul id="filter"> 
						<li class="dropdown head-dpdn">
							<select name="filter_by" id="filter_by" class="form-control1">
								<option value="-1">Filter By</option>
								<option value="0">Low price</option>
								<option value="1">High price</option>
							</select>
						</li>
						<li class="dropdown head-dpdn">
							<select name="brands" id="brands" class="form-control1">
								<option value="-1">Brands</option>
								<option value="samsung">Samsung</option>
								<option value="lg">LG</option>
								<option value="sony">Sony</option>
								<option value="other">Other</option>
							</select>
						</li>
					</ul> 
					<div class="clearfix"> </div>
				</div>
				<!--Đoạn script add paypal  -->
<script src="../js/minicart.min.js"></script>
<script>
    	paypal.minicart.render();
</script>				
				<div class="products-row" id="listproduct">
					<div class="col-md-3 product-grids" th:each="product : ${products}">
						<div class="agile-products">
							<div class="new-tag"><h6>New</h6></div>
							<a href="single.html" th:href="'/market/'+${product.id}+'/single'"><img src="../images/e2.png" th:src="'../../images/'+${product.main_image}" class="img-responsive" th:alt="${product.main_image}"></img></a>
							<div class="agile-product-text">              
								<h5><a th:href="'/market/'+${product.id}+'/single'" href="single.html" th:text="${product.name}">Refrigerator</a></h5> 
								<h6 ><del th:text="'$'+${product.price}">$700</del> <i th:text="'$'+(${product.price}-(${product.price}*${product.is_sale})/100)">$300</i></h6> 
								<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<!-- 									<input type="hidden" name="cmd" value="_cart" ></input>
									<input type="hidden" name="add" value="1" ></input> 
									<input type="hidden" name="w3ls_item" value="Refrigerator" ></input> 
									<input type="hidden" name="amount" value="300.00" ></input>  -->
									<!--  -->
									<input type="hidden" name="cmd" value="_cart"/>
									<input type="hidden" name="add" value="1"/>
									<input type="hidden" name="business" value=""/>
									<input type="hidden" name="item_name" th:attr="value=${product.name}"/>
									<input type="hidden" name="item_number" th:attr="value=${product.id}"/>
									<input type="hidden" name="amount" th:attr="value=${product.price}"/>
									<input type="hidden" name="shipping" value="00"/>
									<input type="hidden" name="shipping2" value="50"/>
									<input type="hidden" name="handling" value="2.00 "/>
									<input type="hidden" name="currency_code" value="USD"/>
									<input type="hidden" name="return" value=""/>
									<input type="hidden" name="undefined_quantity" value="1"/>
									<!--  -->
									<button type="submit" name="submit" class="w3ls-cart pw3ls-cart"><i class="fa fa-cart-plus" aria-hidden="true"></i> Add to cart</button>
								</form>
							</div>
						</div>
					</div> 
					<div class="clearfix"> </div>
				</div>
				<!-- add-products --> 
				<div class="w3ls-add-grids w3agile-add-products">
					<a href="#"> 
						<h4>TOP 10 TRENDS FOR YOU FLAT <span>20%</span> OFF</h4>
						<h6>Shop now <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></h6>
					</a>
				</div> 
				<!-- //add-products -->
			</div>
			<div class="col-md-3 rsidebar">
				<div class="rsidebar-top" id="checkbox_product">
					<div class="slider-left">
						<h4>Filter By Price</h4>            
						<div class="row row1 scroll-pane " id="checkbox_price_product">
							<label class="checkbox"><input type="checkbox" id="checkboxprice" name="checkboxprice[]" value="0-100"></input><i></i>0 - $100 </label>
							<label class="checkbox"><input type="checkbox" id="checkboxprice" name="checkboxprice[]" value="100-200"></input><i></i>$100 - $200 </label> 
							<label class="checkbox"><input type="checkbox" id="checkboxprice" name="checkboxprice[]" value="200-250"></input><i></i>$200 - $250  </label> 
							<label class="checkbox"><input type="checkbox" id="checkboxprice" name="checkboxprice[]" value="250-300"></input><i></i>$250 - $300 </label> 
							<label class="checkbox"><input type="checkbox" id="checkboxprice" name="checkboxprice[]" value="350-400"></input><i></i>$350 - $400 </label> 
						</div> 
					</div>
					<div class="sidebar-row">
						<h4>DISCOUNTS</h4>
						<div class="row row1 scroll-pane checkbox_product " id="checkbox_sale_product">
							<label class="checkbox"><input type="checkbox" id="checkboxsale" name="checkboxsale[]" value="0-10"></input><i></i>Upto - 10% </label>
							<label class="checkbox"><input type="checkbox" id="checkboxsale" name="checkboxsale[]" value="10-20"></input><i></i>10% - 20% </label>
							<label class="checkbox"><input type="checkbox" id="checkboxsale" name="checkboxsale[]" value="20-30"></input><i></i>20% - 30% </label>
							<label class="checkbox"><input type="checkbox" id="checkboxsale" name="checkboxsale[]" value="30-40"></input><i></i>30% - 40% </label>
							<label class="checkbox"><input type="checkbox" id="checkboxsale" name="checkboxsale[]" value="40-50"></input><i></i>40% - 50% </label>
						</div>
					</div>
								 
				</div>
				
				<div class="related-row">
					<h4>YOU MAY ALSO LIKE</h4>
					<div class="galry-like">  
						<a href="single.html"><img src="../images/e1.png" class="img-responsive" alt="img"></img></a>             
						<h4><a href="products.html">Audio speaker</a></h4> 
						<h5>$100</h5>       
					</div>
				</div>
			</div>
			<div class="clearfix"> </div>
		</div>
	</div>
	<!--//products-->  
	<!-- footer-top -->
	<div class="w3agile-ftr-top">
		<div class="container">
			<div class="ftr-toprow">
				<div class="col-md-4 ftr-top-grids">
					<div class="ftr-top-left">
						<i class="fa fa-truck" aria-hidden="true"></i>
					</div> 
					<div class="ftr-top-right">
						<h4>FREE DELIVERY</h4>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce tempus justo ac </p>
					</div> 
					<div class="clearfix"> </div>
				</div> 
				<div class="col-md-4 ftr-top-grids">
					<div class="ftr-top-left">
						<i class="fa fa-user" aria-hidden="true"></i>
					</div> 
					<div class="ftr-top-right">
						<h4>CUSTOMER CARE</h4>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce tempus justo ac </p>
					</div> 
					<div class="clearfix"> </div>
				</div>
				<div class="col-md-4 ftr-top-grids">
					<div class="ftr-top-left">
						<i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
					</div> 
					<div class="ftr-top-right">
						<h4>GOOD QUALITY</h4>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce tempus justo ac </p>
					</div>
					<div class="clearfix"> </div>
				</div> 
				<div class="clearfix"> </div>
			</div>
		</div>
	</div>
	<!-- //footer-top -->  
	<!-- subscribe -->
	<div class="subscribe"> 
		<div class="container">
			<div class="col-md-6 social-icons w3-agile-icons">
				<h4>Keep in touch</h4>  
				<ul>
					<li><a href="#" class="fa fa-facebook icon facebook"> </a></li>
					<li><a href="#" class="fa fa-twitter icon twitter"> </a></li>
					<li><a href="#" class="fa fa-google-plus icon googleplus"> </a></li>
					<li><a href="#" class="fa fa-dribbble icon dribbble"> </a></li>
					<li><a href="#" class="fa fa-rss icon rss"> </a></li> 
				</ul>
				<ul class="apps"> 
					<li><h4>Download Our app : </h4> </li>
					<li><a href="#" class="fa fa-apple"></a></li>
					<li><a href="#" class="fa fa-windows"></a></li>
					<li><a href="#" class="fa fa-android"></a></li>
				</ul>
			</div> 
			<div class="col-md-6 subscribe-right">
				<h4>Sign up for email and get 25%off!</h4> 
				<form action="#" method="post"> 
					<input type="text" name="email" placeholder="Enter your Email..." required=""></input>
					<input type="submit" value="Subscribe"></input>
				</form>
				<div class="clearfix"> </div> 
			</div>
			<div class="clearfix"> </div>
		</div>
	</div>
	<!-- //subscribe --> 
    <!-- /.container -->
    <footer th:replace="layout :: footer"></footer>
    <div th:replace="layout :: copy-right"></div>
    <div th:replace="layout :: popup-pay"></div>
</body>
<script type="text/javascript">
$(document).ready(function () {

	 /*$("#btnsearchproduct").click(function (event) {

        //stop submit the form, we will post it manually.
        event.preventDefault();
        ajax_submit_search_product();

    });*/
    $('#filter').change(function(event){
    	event.preventDefault();
    	console.log('filter by :'+$('#filter_by :selected').val());
    	console.log('brands :'+$('#brands :selected').val());
    	ajax_filter_and_brands($('#filter_by :selected').val(), $('#brands :selected').val());
    });
	$('#checkbox_product input').change(function(){
		var price = [];
		$('#checkboxprice:checked').each(function(i){
			price[i] = $(this).val();
		});
		console.log("price :"+price);
		var sale = [];
        $('#checkboxsale:checked').each(function(i){
          sale[i] = $(this).val();
        });
        console.log("sale :"+sale);
        ajax_search_product(price, sale);
	});
});

function ajax_filter_and_brands(filter, brands){
	var arrFilter= {};
	arrFilter["filter"]=filter;
	arrFilter["brands"]=brands;
	console.log(arrFilter);
	$.ajax({
		type:"POST",
		contentType: "application/json; charset=utf-8",
		url:'/market/products/filter_and_brands',
		data:JSON.stringify(arrFilter),
		dataType : 'JSON',
        cache: false,
        timeout: 60000,
		success:function(data){
			var i;
        	var count=parseInt(data.length);
        	var html="";
        	for (var i in data) {
        		  var id= data[i]["id"];
        		  var name= data[i]["name"];
        		  var price= data[i]["price"];
        		  var price_sale= (data[i]["price"]-(data[i]["price"]*data[i]["is_sale"])/100);
        		  var main_image= data[i]["main_image"];
        		  html+='<div class="col-md-3 product-grids">'+
					'<div class="agile-products">'+
						'<div class="new-tag"><h6>New</h6></div>'+
						'<a href="/market/'+id+'/single.html"><img src="../../images/'+main_image+'" class="img-responsive" alt="'+main_image+'"></img></a>'+
						'<div class="agile-product-text">'+             
							'<h5><a href="/market/'+id+'/single">'+name+'</a></h5>'+
							'<h6 ><del>$'+price+'</del> <i>$'+price_sale+'</i></h6>'+
							'<form action="#" method="post">'+
								'<input type="hidden" name="cmd" value="_cart" ></input>'+
								'<input type="hidden" name="add" value="1" ></input>'+ 
								'<input type="hidden" name="w3ls_item" value="Refrigerator" ></input>'+ 
								'<input type="hidden" name="amount" value="$'+price_sale+'"></input>'+
								'<button type="submit" class="w3ls-cart pw3ls-cart"><i class="fa fa-cart-plus" aria-hidden="true"></i> Add to cart</button>'+
							'</form>'+
						'</div>'+
					'</div>'+
				'</div>';
				
        	}
        	console.log(data.length);
        	$("#listproduct").html(html+'<div class="clearfix"> </div>');
		}
	});
}

function ajax_search_product(price, sale) {
	var pr=[]
	pr=price;
	var sal=[]
	sal=sale;
	var search={};
	search["price"]=pr;
	search["sale"]=sal;
	console.log(search);
	$.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/market/products/search_than",
        data: JSON.stringify(search),
        dataType : 'JSON',
        cache: false,
        timeout: 60000,
        success: function (data) {
        	var i;
        	var count=parseInt(data.length);
        	var html="";
        	for (var i in data) {
        		  var id= data[i]["id"];
        		  var name= data[i]["name"];
        		  var price= data[i]["price"];
        		  var price_sale= (data[i]["price"]-(data[i]["price"]*data[i]["is_sale"])/100);
        		  var main_image= data[i]["main_image"];
        		  html+='<div class="col-md-3 product-grids">'+
					'<div class="agile-products">'+
						'<div class="new-tag"><h6>New</h6></div>'+
						'<a href="/market/'+id+'/single.html"><img src="../../images/'+main_image+'" class="img-responsive" alt="'+main_image+'"></img></a>'+
						'<div class="agile-product-text">'+             
							'<h5><a href="/market/'+id+'/single">'+name+'</a></h5>'+
							'<h6 ><del>$'+price+'</del> <i>$'+price_sale+'</i></h6>'+
							'<form action="#" method="post">'+
								'<input type="hidden" name="cmd" value="_cart" ></input>'+
								'<input type="hidden" name="add" value="1" ></input>'+ 
								'<input type="hidden" name="w3ls_item" value="Refrigerator" ></input>'+ 
								'<input type="hidden" name="amount" value="$'+price_sale+'"></input>'+
								'<button type="submit" class="w3ls-cart pw3ls-cart"><i class="fa fa-cart-plus" aria-hidden="true"></i> Add to cart</button>'+
							'</form>'+
						'</div>'+
					'</div>'+
				'</div>';
				
        	}
        	console.log(data.length);
        	$("#listproduct").html(html+'<div class="clearfix"> </div>');
        },
        error : function(e) {
            console.log("ERROR: ", e);
        }
    });

}
</script>
</html>